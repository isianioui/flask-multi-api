# Orchestration API - SystÃ¨me de Coordination

## Description
API centralisÃ©e qui orchestre et coordonne toutes les APIs d'organes. Elle permet l'agrÃ©gation des donnÃ©es, la surveillance globale et la coordination des simulations.

## Installation
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# ou venv\Scripts\activate  # Windows
pip install -r requirements.txt
```

## Configuration

### PrÃ©requis
Avant de dÃ©marrer l'orchestrateur, **TOUTES** les APIs d'organes doivent Ãªtre lancÃ©es :
- Cardiac API (port 5001)
- Respiratory API (port 5002)
- Neural API (port 5003)

### DÃ©marrage
```bash
python app.py
```
Port : **5000**

## Endpoints

### 1. Vue d'ensemble du systÃ¨me
```
GET /api/orchestration/overview
```
Retourne une vue complÃ¨te incluant l'Ã©tat de santÃ© et le statut de tous les organes.

**RÃ©ponse exemple :**
```json
{
  "timestamp": "2025-11-19T10:30:00",
  "system_health": {
    "overall_status": "healthy",
    "organs": {
      "cardiac": {"status": "healthy"},
      "respiratory": {"status": "healthy"},
      "neural": {"status": "healthy"}
    }
  },
  "organ_statuses": {
    "cardiac": {...},
    "respiratory": {...},
    "neural": {...}
  }
}
```

### 2. VÃ©rification de santÃ©
```
GET /api/orchestration/health
```
VÃ©rifie l'Ã©tat de santÃ© de toutes les APIs d'organes.

### 3. DonnÃ©es agrÃ©gÃ©es
```
GET /api/orchestration/data/all?count=1
```
RÃ©cupÃ¨re les donnÃ©es de tous les organes en une seule requÃªte.

**ParamÃ¨tres :**
- `count` : Nombre de points de donnÃ©es (1-100)

### 4. DonnÃ©es d'un organe spÃ©cifique
```
GET /api/orchestration/data/<organ>?count=1
```
RÃ©cupÃ¨re les donnÃ©es d'un organe via l'orchestrateur.

**Organes disponibles :** `cardiac`, `respiratory`, `neural`

### 5. Statut d'un organe
```
GET /api/orchestration/status/<organ>
```
RÃ©cupÃ¨re le statut dÃ©taillÃ© d'un organe spÃ©cifique.

### 6. Simulation de conditions
```
POST /api/orchestration/simulate
```
Simule des conditions sur un ou plusieurs organes simultanÃ©ment.

**Corps de la requÃªte :**
```json
{
  "cardiac": "tachycardia",
  "respiratory": "asthma",
  "neural": "stress"
}
```

**Alternative - Simulation sur un seul organe :**
```
POST /api/orchestration/simulate/<organ>/<condition>
```

### 7. Mise Ã  jour des paramÃ¨tres
```
POST /api/orchestration/parameters
```
Met Ã  jour les paramÃ¨tres de tous les organes en une fois.

**Corps de la requÃªte :**
```json
{
  "age": 45,
  "sex": "F",
  "activity_level": "light_exercise"
}
```

**Alternative - ParamÃ¨tres d'un seul organe :**
```
POST /api/orchestration/parameters/<organ>
```

### 8. Liste des organes
```
GET /api/orchestration/organs
```
Retourne la liste de tous les organes disponibles avec leurs configurations.

## Exemples d'Utilisation

### Python

```python
import requests
import json

BASE_URL = "http://localhost:5000"

# 1. VÃ©rifier la santÃ© du systÃ¨me
health = requests.get(f"{BASE_URL}/api/orchestration/health")
print(json.dumps(health.json(), indent=2))

# 2. Vue d'ensemble complÃ¨te
overview = requests.get(f"{BASE_URL}/api/orchestration/overview")
print(json.dumps(overview.json(), indent=2))

# 3. RÃ©cupÃ©rer toutes les donnÃ©es
all_data = requests.get(f"{BASE_URL}/api/orchestration/data/all?count=1")
print(json.dumps(all_data.json(), indent=2))

# 4. Simuler plusieurs conditions simultanÃ©ment
simulations = {
    "cardiac": "tachycardia",
    "respiratory": "asthma",
    "neural": "stress"
}
response = requests.post(
    f"{BASE_URL}/api/orchestration/simulate",
    json=simulations
)
print(json.dumps(response.json(), indent=2))

# 5. Mettre Ã  jour les paramÃ¨tres globaux
params = {
    "age": 50,
    "sex": "M",
    "activity_level": "intense_exercise"
}
response = requests.post(
    f"{BASE_URL}/api/orchestration/parameters",
    json=params
)
print(json.dumps(response.json(), indent=2))

# 6. RÃ©cupÃ©rer les donnÃ©es mises Ã  jour
updated_data = requests.get(f"{BASE_URL}/api/orchestration/data/all")
print(json.dumps(updated_data.json(), indent=2))
```

### cURL

```bash
# Vue d'ensemble
curl http://localhost:5000/api/orchestration/overview

# SantÃ© du systÃ¨me
curl http://localhost:5000/api/orchestration/health

# Toutes les donnÃ©es
curl http://localhost:5000/api/orchestration/data/all?count=5

# DonnÃ©es d'un organe
curl http://localhost:5000/api/orchestration/data/cardiac

# Simulation multiple
curl -X POST http://localhost:5000/api/orchestration/simulate \
  -H "Content-Type: application/json" \
  -d '{"cardiac":"hypertension","respiratory":"copd"}'

# Simulation simple
curl -X POST http://localhost:5000/api/orchestration/simulate/cardiac/tachycardia

# ParamÃ¨tres globaux
curl -X POST http://localhost:5000/api/orchestration/parameters \
  -H "Content-Type: application/json" \
  -d '{"age":60,"sex":"F","activity_level":"resting"}'

# ParamÃ¨tres d'un organe
curl -X POST http://localhost:5000/api/orchestration/parameters/neural \
  -H "Content-Type: application/json" \
  -d '{"mental_state":"relaxed"}'

# Liste des organes
curl http://localhost:5000/api/orchestration/organs
```

## ScÃ©narios d'Utilisation

### ScÃ©nario 1 : Monitoring Complet
```python
import requests
import time

BASE_URL = "http://localhost:5000"

# Boucle de monitoring
while True:
    overview = requests.get(f"{BASE_URL}/api/orchestration/overview").json()
    
    print(f"\n=== Ã‰tat du SystÃ¨me Ã  {overview['timestamp']} ===")
    print(f"Statut global: {overview['system_health']['overall_status']}")
    
    for organ, status in overview['system_health']['organs'].items():
        print(f"  {organ}: {status['status']}")
    
    time.sleep(10)  # VÃ©rifier toutes les 10 secondes
```

### ScÃ©nario 2 : Simulation d'Urgence MÃ©dicale
```python
import requests

BASE_URL = "http://localhost:5000"

# Simuler une crise cardiaque avec complications respiratoires
emergency_conditions = {
    "cardiac": "tachycardia",
    "respiratory": "hyperventilation",
    "neural": "stress"
}

print("âš ï¸  Simulation d'urgence mÃ©dicale...")
response = requests.post(
    f"{BASE_URL}/api/orchestration/simulate",
    json=emergency_conditions
)

print("Conditions activÃ©es:")
for organ, result in response.json()['simulations'].items():
    print(f"  {organ}: {result['message']}")

# RÃ©cupÃ©rer les donnÃ©es pendant la crise
data = requests.get(f"{BASE_URL}/api/orchestration/data/all?count=10").json()
print(f"\nDonnÃ©es collectÃ©es: {data['data_count']} points par organe")
```

### ScÃ©nario 3 : Test de RÃ©sistance Physique
```python
import requests
import time

BASE_URL = "http://localhost:5000"

# Simulation d'exercice intense
print("ğŸƒ DÃ©marrage simulation d'exercice intense...")

# Configurer l'activitÃ© intense
params = {"activity_level": "intense_exercise"}
requests.post(f"{BASE_URL}/api/orchestration/parameters", json=params)

# Collecter les donnÃ©es pendant 30 secondes
for i in range(6):
    data = requests.get(f"{BASE_URL}/api/orchestration/data/all").json()
    
    cardiac = data['organs']['cardiac']['data']
    respiratory = data['organs']['respiratory']['data']
    
    print(f"\nTemps {i*5}s:")
    print(f"  FrÃ©quence cardiaque: {cardiac['heart_rate']} bpm")
    print(f"  FrÃ©quence respiratoire: {respiratory['respiratory_rate']} /min")
    print(f"  Saturation O2: {cardiac['oxygen_saturation']}%")
    
    time.sleep(5)

# Retour au repos
requests.post(
    f"{BASE_URL}/api/orchestration/parameters",
    json={"activity_level": "resting"}
)
print("\nâœ“ Retour au repos")
```

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Orchestration API (5000)      â”‚
â”‚   Coordination centrale          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚           â”‚          â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚Cardiac  â”‚ â”‚Respira-â”‚ â”‚Neural  â”‚
â”‚API      â”‚ â”‚tory APIâ”‚ â”‚API     â”‚
â”‚(5001)   â”‚ â”‚(5002)  â”‚ â”‚(5003)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Gestion des Erreurs

L'orchestrateur gÃ¨re plusieurs types d'erreurs :

- **API Offline** : L'API d'un organe n'est pas accessible
- **Timeout** : L'API ne rÃ©pond pas dans le dÃ©lai imparti
- **Invalid Request** : ParamÃ¨tres invalides
- **Partial Failure** : Certaines APIs rÃ©pondent, d'autres non

Exemple de rÃ©ponse en cas d'erreur partielle :
```json
{
  "organs": {
    "cardiac": {
      "data": {...}
    },
    "respiratory": {
      "error": "Cannot connect to API"
    },
    "neural": {
      "data": {...}
    }
  }
}
```

## ConsidÃ©rations de Performance

- **Timeout** : 5 secondes par requÃªte API
- **ParallÃ©lisme** : Les requÃªtes peuvent Ãªtre optimisÃ©es avec threading
- **Cache** : PossibilitÃ© d'ajouter un cache pour les donnÃ©es frÃ©quentes
- **Rate Limiting** : Ã€ implÃ©menter pour la production

## Tests

### Test de ConnectivitÃ©
```bash
# Tester que toutes les APIs sont accessibles
curl http://localhost:5000/api/orchestration/health
```

### Test d'IntÃ©gration
```bash
# Test complet du workflow
curl http://localhost:5000/api/orchestration/overview
curl -X POST http://localhost:5000/api/orchestration/simulate \
  -H "Content-Type: application/json" \
  -d '{"cardiac":"normal","respiratory":"normal","neural":"normal"}'
curl http://localhost:5000/api/orchestration/data/all?count=3
```

## ConsidÃ©rations Ã‰thiques

âš ï¸ **IMPORTANT** : Cette API coordonne des donnÃ©es **SYNTHÃ‰TIQUES** Ã  des fins **PÃ‰DAGOGIQUES**.

- Les donnÃ©es agrÃ©gÃ©es sont synthÃ©tiques
- Ne JAMAIS utiliser pour des diagnostics rÃ©els
- Usage strictement Ã©ducatif
- Aucune donnÃ©e personnelle de santÃ© rÃ©elle

## Port par DÃ©faut
Port : **5000**

## Auteur
Projet pÃ©dagogique - DÃ©veloppement d'APIs Flask